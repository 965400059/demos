!function(z){"use strict";var A="ht",B=z[A],Q=B.Default,W=Math,E=W.PI,M=2*E,V=W.sin,U=W.cos,S=W.atan2,r=W.sqrt,j=W.max,J=W.floor,N=(W.round,W.ceil),C=W.abs,G=B.Shape,b=B.Edge,y=B.List,h=B.Style,Y=B.graph,K=Q.getInternal(),u=K.ui(),i=null,D="__segmentLengths",R="__lineTotalLength",f="__linePoints",t="__distance0",p="flow.count",w="flow.step",F="flow.element.max",n="flow.element.count",d="flow.element.min",I="flow.element.space",O="flow.element.autorotate",c="flow.element.background",X="flow.element.shadow.max",H="flow.element.shadow.min",q="flow.element.shadow.begincolor",o="flow.element.shadow.endcolor",l="flow.element.shadow.visible",L="flow.element.image",e="flow",m="prototype",g=Y.GraphView[m],k=B.Data[m],Z=u.DataUI[m],$=u.ShapeUI[m],P=u.EdgeUI[m],T=B.DataModel[m],v=$._80o,s=P._80o,x=T.prepareRemove,a=P._79o,_=$._79o,Ar=g.setDataModel,Le=function(K){return document.createElement(K)};g.calculatePointLength=function(N,P,L){var J=this,K=J.getDataUI(N);L==i&&(L=.1);var D=bl(K),a=[];if(D){for(var Y=D.length,u=0;Y>u;u++){var f=D[u];f._as&&(f=f._as);for(var $=f[0],C=1;C<f.length;C++)a.push([$,f[C]]),$=f[C]}for(var O=[],u=0;u<a.length;u++){var R=nq(a[u][0],a[u][1],P);O.push(R)}var I=O.slice(0);I.sort(function(g,I){return g.z>I.z?1:g.z<I.z?-1:0});var l=I[0];if(l.z<L){for(var T=O.indexOf(l),Z=0,u=0;T>=u;u++)Z+=T>u?Q.getDistance(a[u][0],a[u][1]):Q.getDistance(a[u][0],l);return Z}}},Q.calculatePointLength=function(L,U,b,f){f==i&&(f=.1);var w=bl(i,L,U),U=[];if(w){for(var o=w.length,A=0;o>A;A++){var d=w[A];d._as&&(d=d._as);for(var K=d[0],H=1;H<d.length;H++)U.push([K,d[H]]),K=d[H]}for(var W=[],A=0;A<U.length;A++){var V=nq(U[A][0],U[A][1],b);W.push(V)}var n=W.slice(0);n.sort(function(s,m){return s.z>m.z?1:s.z<m.z?-1:0});var m=n[0];if(m.z<f){for(var h=W.indexOf(m),G=0,A=0;h>=A;A++)G+=h>A?Q.getDistance(U[A][0],U[A][1]):Q.getDistance(U[A][0],m);return G}}},g.calculateClosestPoint=function(g,i){var I=this,v=I.getDataUI(g),y=bl(v),T=[];if(y){for(var R=y.length,E=0;R>E;E++){var S=y[E];S._as&&(S=S._as);for(var M=S[0],h=1;h<S.length;h++)T.push([M,S[h]]),M=S[h]}for(var V=[],E=0;E<T.length;E++){var c=nq(T[E][0],T[E][1],i);V.push(c)}return V.sort(function(A,E){return A.z>E.z?1:A.z<E.z?-1:0}),V[0]}},Q.calculateClosestPoint=function(N,m,z){var r=bl(i,N,m),m=[];if(r){for(var R=r.length,e=0;R>e;e++){var k=r[e];k._as&&(k=k._as);for(var q=k[0],D=1;D<k.length;D++)m.push([q,k[D]]),q=k[D]}for(var U=[],e=0;e<m.length;e++){var M=nq(m[e][0],m[e][1],z);U.push(M)}return U.sort(function(N,$){return N.z>$.z?1:N.z<$.z?-1:0}),U[0]}},g.getPercentAngle=function(h,g){var A=this,H=A.getDataUI(h),M=h.getRotation?h.getRotation():0,v=bl(H);if(v)if(0===g){var E=v[0][0],e=v[0][1];M+=S(e.y-E.y,e.x-E.x)}else if(100===g){v=v[v.length-1];var E=v[v.length-2],e=v[v.length-1];M+=S(e.y-E.y,e.x-E.x)}else{for(var t=0,y=[],f=v.length,J=0;f>J;J++){var X=v[J],I=ag(X);t+=I,y.push(I)}for(var G=t*g/100,F=Jj(G,y),C=0,j=0;F>j;j++)C+=y[j];G-=C;for(var Z=ko(v[F],G),q=v[F],$=0,_=0,m=0;m<q.length-1;m++){var V=q[m],R=q[m+1],c=R.x-V.x,k=R.y-V.y,b=r(c*c+k*k);if($+=b,$>G){_=m;break}}var n=q[_];M+=S(Z.y-n.y,Z.x-n.x)}return M},Q.getPercentAngle=function(G,B,W){var v=0,b=bl(i,G,B);if(b)if(0===W){var Y=b[0][0],K=b[0][1];v+=S(K.y-Y.y,K.x-Y.x)}else if(100===W){b=b[b.length-1];var Y=b[b.length-2],K=b[b.length-1];v+=S(K.y-Y.y,K.x-Y.x)}else{for(var Q=0,d=[],x=b.length,n=0;x>n;n++){var p=b[n],U=ag(p);Q+=U,d.push(U)}for(var u=Q*W/100,H=Jj(u,d),R=0,E=0;H>E;E++)R+=d[E];u-=R;for(var D=ko(b[H],u),T=b[H],X=0,l=0,g=0;g<T.length-1;g++){var q=T[g],V=T[g+1],$=V.x-q.x,M=V.y-q.y,J=r($*$+M*M);if(X+=J,X>u){l=g;break}}var w=T[l];v+=S(D.y-w.y,D.x-w.x)}return v},g.calculateLength=function(n){var x=this,U=x.getDataUI(n),i=bl(U),$=0;if(i)if(Array.isArray(i[0]))for(var K=i.length,M=0;K>M;M++){var l=i[M],g=ag(l);$+=g}else $=ag(i);return $},Q.calculateLength=function(F,a){var F=bl(i,F,a),R=0;if(F)if(Array.isArray(F[0]))for(var p=F.length,A=0;p>A;A++){var H=F[A],d=ag(H);R+=d}else R=ag(F);return R};var nq=Q.calculateClosestPointOnLine=function(V,Z,o){var F=V.x,D=V.y,i=Z.x,y=Z.y,R=o.x,N=o.y,e={},I=i-F,c=y-D,r=Math.sqrt(I*I+c*c),O=I/r,n=c/r,s=(-F+R)*O+(-D+N)*n;return e.x=F+s*O,e.y=D+s*n,El(e,V,Z)||(e.x=Math.abs(e.x-V.x)<Math.abs(e.x-Z.x)?V.x:Z.x,e.y=Math.abs(e.y-V.y)<Math.abs(e.y-Z.y)?V.y:Z.y),I=R-e.x,c=N-e.y,e.z=Math.sqrt(I*I+c*c),e},El=function(U,r,I){return U.x>=Math.min(r.x,I.x)&&U.x<=Math.max(r.x,I.x)&&U.y>=Math.min(r.y,I.y)&&U.y<=Math.max(r.y,I.y)},ag=function(G){for(var n=0,s=G.length-1,_=0;s>_;_++){var u=G[_],L=G[_+1],q=L.x-u.x,$=L.y-u.y,a=r(q*q+$*$);n+=a}return n},ko=function(m,y){for(var g=0,G=0,Q=0,_=m.length-1,O=0;_>O;O++){var p=m[O],f=m[O+1],R=f.x-p.x,q=f.y-p.y;if(Q=r(R*R+q*q),g+=Q,g>y){g-=Q,G=O;break}}var N=m[G],j=m[G+1],c=S(j.y-N.y,j.x-N.x),x=y-g,q=V(c)*x,R=U(c)*x;return{x:N.x+R,y:N.y+q}},Kj=function(G,c,X,F){var H=U(F),t=V(F),C=H*c-t*X,L=t*c+H*X;return G?{x:G.x+C,y:G.y+L}:{x:C,y:L}},ir=function(b,I){b[D]=b[R]=b[f]=I[t]=i},Vj=function(p,X,g,m,R,Q){var _,I,r,Y,d,u,o,b,s,G,D,y=[];if(C(m)>M&&(m=M),d=N(C(m)/(E/4)),_=m/d,I=-_,r=-g,d>0){u=p+U(g)*R,o=X+V(-g)*Q,y.push({x:u,y:o});for(var S=0;d>S;S++)r+=I,Y=r-I/2,b=p+U(r)*R,s=X+V(r)*Q,G=p+U(Y)*(R/U(I/2)),D=X+V(Y)*(Q/U(I/2)),y.push({x:G,y:D}),y.push({x:b,y:s})}return y},bl=function(d,N,$){if(N==i){var p=d._data;if(p instanceof G){if(N=p.getPoints(),$=p.getSegments(),(!$||0===$.size())&&N){$=new B.List([1]);for(var U=1;U<N.size();U++)$.add(2)}}else if(p instanceof b){var L=d._78o;if(L){var t=L.type,f=L.points,V=L.segments,e=L.edgeTypeInfo;if(!t||f){var z=L.sourcePoint,Z=z.x,W=z.y,R=L.targetPoint,o=R.x,v=R.y;if(t)V?(N=new y({x:Z,y:W}),N.addAll(f),N.add({x:o,y:v}),$=new y(V._as)):(N=new y({x:Z,y:W}),$=new y([1]),f.each(function(X){N.add(X),$.add(2)}),N.add({x:o,y:v}),$.add(2));else if(L.looped){N=new y(Vj(Z,W,0,M,L.radius,L.radius)),$=new y([1]);for(var U=0;U<(N.size()-1)/2;U++)$.add(3)}else N=new y,L.center?(N.add({x:L.c1.x,y:L.c1.y}),N.add({x:Z,y:W}),N.add({x:o,y:v}),N.add({x:L.c2.x,y:L.c2.y}),$=new y([1,2,2,2])):(N.add({x:Z,y:W}),N.add({x:o,y:v}),$=new y([1,2]))}else if(e)if(N=new y(e.points._as),e.segments)$=new y(e.segments._as);else{$=new y([1]);for(var U=1;U<e.points.size();U++)$.add(2)}}}}if(N){if(Array.isArray(N)&&(N=new y(N)),"number"==typeof N.get(0)){for(var H=new B.List,U=0;U<N.size();U+=2)H.add({x:N.get(U),y:N.get(U+1)});N=H}if(!$){$=[];for(var U=0;U<N.size();U++)0===U?$.push(1):$.push(2)}Array.isArray($)&&($=new y($));for(var D=K.toPointsArray(N._as,$._as,50),g=D.length,w=[],U=0;g>U;U++){var n=D[U];n.length>1&&w.push(n)}return w}},ys=function(N){var q=N._data,T=bl(N);if(T){q.s("flow.reverse")&&(T.reverse(),T.forEach(function(P){P.reverse()}));for(var S=0,A=[],M=T.length,r=0;M>r;r++){var H=T[r],x=ag(H);S+=x,A.push(x)}if(q[D]=A,q[R]=S,q[f]=T,q instanceof b){var z=Q.unionPoint(T),Y=z.x+z.width/2,E=z.y+z.height/2;q.$10e={x:Y,y:E}}Si(N,!0)}},Si=(Q.getPercentPositionOnPoints=function(K,Z,D){if(K){var P=bl(i,K,Z);if(P){var Y;if(0===D)Y=P[0][0];else if(100===D)P=P[P.length-1],Y=P[P.length-1];else{for(var T=0,t=[],U=P.length,_=0;U>_;_++){var g=P[_],E=ag(g);T+=E,t.push(E)}for(var $=T*D/100,x=Jj($,t),s=0,I=0;x>I;I++)s+=t[I];$-=s,Y=ko(P[x],$)}return Y}}},g.getPercentPosition=function(a,Z){var b=this,e=b.getDataUI(a),T=bl(e);if(T){var U;if(0===Z)U=T[0][0];else if(100===Z)T=T[T.length-1],U=T[T.length-1];else{for(var I=0,K=[],Y=T.length,m=0;Y>m;m++){var S=T[m],X=ag(S);I+=X,K.push(X)}for(var W=I*Z/100,O=Jj(W,K),l=0,n=0;O>n;n++)l+=K[n];W-=l,U=ko(T[O],W)}return U}},function(g,a){var Q=g._data,Y=Q[R],A=Q.s(p),c=Q.s(w),L=0,U=Q[D],u=Q.s(F),N=Q.s(d),e=Q.s(n),z=(u-N)/(e-1),f=[];if(U){if(1===e)f.push(u);else if(2===e)f.push(u),f.push(N);else{if(!(e>2))return;f.push(u);for(var H=e-2;H>0;H--)f.push(N+z*H);f.push(N)}var m=0,O=0;f.forEach(function(d){e-1>m&&(O+=Q.getFlowElementSpace(d)),m++}),O+=(u+N)/2,L=(Y-A*O+O)/A;var s=g[t];for(null==s&&(s=0),a||(s+=c);s>Y+O;){var k=g._overCount;k?k++:k=1,k>=A&&(k=null),g._overCount=k,Q.s("flow.autoreverse")?k?s-=L+O:(s=0,Q.s("flow.reverse",!Q.s("flow.reverse"))):s-=L+O}g[t]=s}}),Ci=function(T){var U=T.data,l=this.dm();if(U&&"add"===T.kind){var u=l.$3e;u&&U.s(e)&&u.indexOf(U)<0&&u.push(U)}"clear"===T.kind&&(l.$3e=[])},Xp=function(N){var V=N.property,w=N.data,r=N.newValue,A=this.dm().$3e;if(A&&"s:flow"===V)if(r)A.indexOf(w)<0&&A.push(w);else for(var a=A.length,B=0;a>B;B++)if(A[B]===w){A.splice(B,1);break}},Jj=Jj=function(M,z){for(var g=0,D=z.length,S=0;D>S;S++){var B=z[S];if(g+=B,g>M)return S}return Math.min(S,D-1)},sl=function(P){var j=this,$=j._data,v=$[R],J=$[D],e=$[f],k=$.s(p),z=0,B=j[t],E=$.s(F),x=$.s(d),Z=$.s(n),w=$.s(H),y=$.s(X),A=$.s(O),m=(y-w)/(Z-1),G=(E-x)/(Z-1),l=$.getRotation?$.getRotation():0,T=$.getPosition?$.p():$.$10e,Y=[],a=[];if(B!=i){if(1===Z)Y.push(E);else if(2===Z)Y.push(E),Y.push(x);else{if(!(Z>2))return;Y.push(E);for(var V=Z-2;V>0;V--)Y.push(x+G*V);Y.push(x)}if(1===Z)a.push(y);else if(2===Z)a.push(y),a.push(w);else{if(!(Z>2))return;a.push(y);for(var V=Z-2;V>0;V--)a.push(w+m*V);a.push(w)}var M=0,u=0;Y.forEach(function(H){Z-1>M&&(u+=$.getFlowElementSpace(H)),M++}),u+=(E+x)/2,z=(v-k*u+u)/k,P.save();for(var V=0;k>V;V++){var N=B,C=0,U=j._overCount,_=0;$.s("flow.autoreverse")&&U&&U>k-(V+1)||(N-=V*(z+u),M=0,Y.forEach(function(t){var n=N-C;if(n>=0&&v>n){var U=!0,w=Jj(n,J);_=0;for(var s=0;w>s;s++)_+=J[s];if(n-=_,U){var K=ko(e[w],n),G=l;if(A){for(var y=e[w],H=0,h=0,V=0;V<y.length-1;V++){var F=y[V],k=y[V+1],z=k.x-F.x,I=k.y-F.y,d=r(z*z+I*I);if(H+=d,H>n){h=V;break}}var f=y[h];G+=S(K.y-f.y,K.x-f.x)}l&&(K=Kj(T,K.x-T.x,K.y-T.y,l)),j.$5e(P,K,t,a[M],G)}}C+=$.getFlowElementSpace(Y[M]),M++}))}P.restore()}},og=function(){var g=this,E=g._data,f=E.s(F),r=!1,u=i;if(g._6I||(r=!0),u=E instanceof b?a.call(g):_.call(g),E.s(e)&&r){var D=E.s(X),T=E.s(l);T&&D>f&&(f=D),f>0&&Q.grow(u,N(f/2)),ys(g)}return!E.s(e)&&r&&ir(E,g),u};k.getFlowElementSpace=function(){return this.s(I)},$._79o=og,P._79o=og,h[F]==i&&(h[F]=7),h[d]==i&&(h[d]=0),h[p]==i&&(h[p]=1),h[w]==i&&(h[w]=3),h[n]==i&&(h[n]=10),h[I]==i&&(h[I]=3.5),h[O]==i&&(h[O]=!1),h[c]==i&&(h[c]="rgba(255, 255, 114, 0.4)"),h[q]==i&&(h[q]="rgba(255, 255, 0, 0.3)"),h[o]==i&&(h[o]="rgba(255, 255, 0, 0)"),h[l]==i&&(h[l]=1),h[X]==i&&(h[X]=22),h[H]==i&&(h[H]=4),T.prepareRemove=function(L){x.call(this,L);var s=L._dataModel,W=s.$3e;if(W)for(var y=W.length,J=0;y>J;J++)if(W[J]===L){W.splice(J,1);break}},g.setDataModel=function(M){var u=this,W=u._dataModel;if(W!==M){W&&(W.umm(Ci,u),W.umd(Xp,u),W.$3e=[]),M.mm(Ci,u),M.md(Xp,u);var $=M.$3e=[];M.each(function(c){c.s(e)&&$.indexOf(c)<0&&$.push(c)}),Ar.call(u,M)}},g.setFlowInterval=function(Z){var N=this,Y=N.$11e;N.$11e=Z,N.fp("flowInterval",Y,Z),N.$7e!=i&&(clearInterval(N.$7e),delete N.$7e,N.enableFlow(Z))},g.getFlowInterval=function(){return this.$11e},g.$9e=function(){var i,T,s,G=this,w=G.tx(),e=G.ty(),v=G.getZoom(),X=G.getWidth(),D=G.getHeight(),g={x:-w/v,y:-e/v,width:X/v,height:D/v},t=G.dm().$3e,l=G._56I,H=new y;if(t.forEach(function($){l[$.getId()]&&(i=G.getDataUI($),i&&(s=i._79o(),s&&H.add(s)))}),0!==H.size()&&(H.each(function(X){Q.intersectsRect(g,X)&&(T=Q.unionRect(T,X))}),T&&(T&&(Q.grow(T,j(1,1/v)),T.x=J(T.x*v)/v,T.y=J(T.y*v)/v,T.width=N(T.width*v)/v,T.height=N(T.height*v)/v,T=Q.intersection(g,T)),T))){var E=G._canvas.getContext("2d");E.save(),E.lineCap=Q.lineCap,E.lineJoin=Q.lineJoin,K.translateAndScale(E,w,e,v),E.beginPath(),E.rect(T.x,T.y,T.width,T.height),E.clip(),E.clearRect(T.x,T.y,T.width,T.height),G.$6e(E,T),E.restore()}},g.$6e=function(M,t){var $,O,I=this;I._93db(M),I.each(function(v){I._56I[v._id]&&($=I.getDataUI(v),$&&(O=$._79o(),(!t||Q.intersectsRect(t,O))&&$._42(M)))}),I._92db(M)},g.enableFlow=function(n){var v=this,C=v.dm(),c=C.$3e;v.$7e==i&&(c.forEach(function(G){var p=v.getDataUI(G);ys(p)}),v.$7e=setInterval(function(){C.$3e.forEach(function(k){Si(v.getDataUI(k))}),v.$9e()},n||v.$11e||50))},g.disableFlow=function(){var D=this;clearInterval(D.$7e),delete D.$7e;var j=D.dm().$3e;j&&D.$9e()},Z.$5e=function(j,g,m,E,w){var S=this,W=S._data,e=S.gv,X=W.s(c),b=W.s(q),C=W.s(o),t=W.s(l),F=e.$8e,I=W.s(L);if(F==i&&(F=e.$8e={}),j.beginPath(),I!=i){var A=Q.getImage(I),O=m/2;j.translate(g.x,g.y),j.rotate(w),j.translate(-g.x,-g.y),Q.drawImage(j,A,g.x-O,g.y-O,m,m,W),j.translate(g.x,g.y),j.rotate(-w),j.translate(-g.x,-g.y)}else j.fillStyle=X,j.arc(g.x,g.y,m/2,0,M,!0),j.fill();if(t){var h=22,k=h+"_"+b+"_"+C,n=F[k];if(n==i){var a=Le("canvas");K.setCanvas(a,h,h);var T=a.getContext("2d"),v=h/2,U=v,d=v;K.translateAndScale(T,0,0,1),T.beginPath();var _=T.createRadialGradient(U,d,0,U,U,v);_.addColorStop(0,b),_.addColorStop(1,C),T.fillStyle=_,T.arc(U,d,v,0,M,!0),T.fill(),n=F[k]=a}var O=E/2;Q.drawImage(j,n,g.x-O,g.y-O,E,E,W)}},P._80o=function(X){s.call(this,X);var n=this,F=n._data,o=n.gv;F.s(e)&&o.$7e!=i&&sl.call(n,X)},$._80o=function(H){v.call(this,H);var Q=this,L=Q._data,X=Q.gv;L.s(e)&&X.$7e!=i&&sl.call(Q,H)}}("undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:(0,eval)("this"),Object);