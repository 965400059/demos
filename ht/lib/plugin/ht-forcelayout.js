!function(T,M){"use strict";var q="ht",m=q+".layout.",z=T[q]||module.parent.exports.ht,f=z.List,l=z.DataModel,O=z.Node,u=z.Edge,b=z.Group,D=Math,_=D.sqrt,x=D.random,J=D.max,e=D.min,v=function(m){return m*m};z.Default.getInternal().addMSMap({ms_force:function(Y){Y._interval=50,Y._stepCount=10,Y._motionLimit=.01,Y._edgeRepulsion=.65,Y._nodeRepulsion=.65,Y._damper=1,Y._maxMotion=0,Y._motionRatio=0,Y.init=function(O){var V=this;O instanceof l?V.dm=O:V.gv=O,V._nodeMap={},V._nodes=new f,V._edges=new f},Y.start=function(){var o=this,d=o.gv;if(!o._timer){var c=o.cdm=d?d.dm():o.dm;c.mm(o.handleDataModelChange,o),c.md(o.handleDataPropertyChange,o),d&&d.mp(o.handleGV,o),c.each(function(z){if(o.isVisible(z)&&o.isLayoutable(z)&&z instanceof O)if(o instanceof Z){var Q=z.p3();z.p3([Q[0]+x(),Q[1]+x(),Q[2]+x()])}else Q=z.p(),z.p(Q.x+x(),Q.y+x())}),o._timer=setInterval(function(){o.relax()},o._interval),o._damper=1}},Y.stop=function(){var W=this;W._timer&&(W.cdm.umm(W.handleDataModelChange,W),W.cdm.umd(W.handleDataPropertyChange,W),W.gv&&W.gv.ump(W.handleGV,W),clearInterval(W._timer),delete W._timer,delete W.cdm)},Y.handleGV=function($){var n=this;if("dataModel"===$.property){var B=$.oldValue,Z=$.newValue;B&&(B.umm(n.handleDataModelChange,n),B.umd(n.handleDataPropertyChange,n)),this.cdm=Z,Z.mm(n.handleDataModelChange,n),Z.md(n.handleDataPropertyChange,n)}},Y.relax=function(){var B=this;if(!(B._damper<.1&&B._maxMotion<B._motionLimit)){this.cdm.each(function(k){B.isVisible(k)&&(k instanceof u?B.addEdge(k):k instanceof O&&B.addNode(k))});for(var x,C,X=0,a=B._edges,d=B._nodes,L=d.size();X<B._stepCount;X++){for(a.each(B.relaxEdge,B),x=0;L>x;x++)for(C=0;L>C;C++)B.relaxNode(d.get(x),d.get(C));B.moveNode()}B._isAdjusting=1,d.each(function(k){k.fix||(k.p?k.v.p3(k.p):k.v.p(k.x,k.y))}),delete B._isAdjusting,B._nodeMap={},d.clear(),a.clear(),B.onRelaxed()}},Y.onRelaxed=function(){},Y.isRunning=function(){return!!this._timer},Y.isVisible=function(C){return C.s("layoutable")===!1?!1:this.gv?this.gv.isVisible(C):!0},Y.isLayoutable=function(C){if(C.s("layoutable")===!1)return!1;if(C instanceof b)return!1;var F=this;return F.gv?F.gv.isMovable(C)&&!F.gv.isSelected(C):!(F.cdm||F.dm).sm().co(C)},Y.getNodeRepulsion=function(){return this._nodeRepulsion},Y.setNodeRepulsion=function(d){this._nodeRepulsion=d,this._damper=1},Y.getEdgeRepulsion=function(){return this._edgeRepulsion},Y.setEdgeRepulsion=function(L){this._edgeRepulsion=L,this._damper=1},Y.getStepCount=function(){return this._stepCount},Y.setStepCount=function(q){this._stepCount=q,this._damper=1},Y.getInterval=function(){return this._interval},Y.setInterval=function(L){var w=this;w._interval!==L&&(w._interval=L,w._timer&&(clearInterval(w._timer),w._timer=setInterval(function(){w.relax()},L)))},Y.handleDataPropertyChange=function(T){!this._isAdjusting&&this.isVisible(T.data)&&(this._damper=1)},Y.handleDataModelChange=function(){this._damper=1},Y.damp=function(){var r=this._maxMotion,n=this._damper;this._motionRatio<=.001&&((.2>r||r>1&&.9>n)&&n>.01?this._damper-=.01:.4>r&&n>.003?this._damper-=.003:n>1e-4&&(this._damper-=1e-4)),r<this._motionLimit&&(this._damper=0)}}}),z.layout.ForceLayout=function(z){this.init(z)},z.Default.def(m+"ForceLayout",M,{ms_force:1,getLimitBounds:function(){return this._limitBounds},setLimitBounds:function(d){this._limitBounds=d,this._damper=1},getNodeSize:function(f){var _=this.gv;return _&&_.getDataUIBounds?_.getDataUIBounds(f):f.getRect()},addNode:function(n){var b=this,Z=b._nodeMap[n._id];if(Z)return Z;var V=n.p();Z={v:n,x:V.x,y:V.y,dx:0,dy:0,fix:!b.isLayoutable(n),s:b.getNodeSize(n)};var S=Z.s,E=_(v(S.width)+v(S.height))*b._nodeRepulsion;return Z.r=1>E?100:E,b._nodeMap[n._id]=Z,b._nodes.add(Z),Z},addEdge:function(n){if(n._40I&&n._41I){var J=this,t=J.addNode(n._40I),v=J.addNode(n._41I),q={s:t,t:v};v=v.s,t=t.s;var N=v.width+t.width,E=v.height+t.height;q.length=_(N*N+E*E)*J._edgeRepulsion,q.length<=0&&(q.length=100),J._edges.add(q)}},relaxEdge:function(Y){var R=Y.t,X=Y.s,G=R.x-X.x,U=R.y-X.y,a=_(G*G+U*U),t=100*Y.length,p=.25*G/t*a,T=.25*U/t*a;R.dx=R.dx-p,R.dy=R.dy-T,X.dx=X.dx+p,X.dy=X.dy+T},relaxNode:function(U,C){if(U!==C){var R=0,Z=0,m=U.x-C.x,K=U.y-C.y,f=m*m+K*K;0===f?(R=x(),Z=x()):36e4>f&&(R=m/f,Z=K/f);var l=U.r*C.r/400;R*=l,Z*=l,U.dx+=R,U.dy+=Z,C.dx-=R,C.dy-=Z}},moveNode:function(){var q=this,g=q._limitBounds,o=q._maxMotion,m=0,U=q._damper;q._nodes.each(function(k){if(!k.fix){var z=k.dx*U,o=k.dy*U;if(k.dx=z/2,k.dy=o/2,m=J(_(z*z+o*o),m),k.x+=J(-40,e(40,z)),k.y+=J(-40,e(40,o)),g){k.x<g.x&&(k.x=g.x,q.adjust(1,0)),k.y<g.y&&(k.y=g.y,q.adjust(0,1));var p=k.s;k.x+p.width>g.x+g.width&&(k.x=g.x+g.width-p.width,q.adjust(-1,0)),k.y+p.height>g.y+g.height&&(k.y=g.y+g.height-p.height,q.adjust(0,-1))}}}),q._maxMotion=m,q._motionRatio=m>0?o/m-1:0,q.damp()},adjust:function(P,D){var F=this._limitBounds;this._nodes.each(function(R){P>0?(!F||R.x+R.s.width+P<F.x+F.width)&&(R.x+=P):(!F||R.x+P>F.x)&&(R.x+=P),D>0?(!F||R.y+R.s.height+D<F.y+F.height)&&(R.y+=D):(!F||R.y+D>F.y)&&(R.y+=D)})}});var Z=z.layout.Force3dLayout=function(h){this.init(h)};z.Default.def(m+"Force3dLayout",M,{ms_force:1,getNodeSize3d:function(n){return n.s3()},addNode:function(I){var i=this,f=i._nodeMap[I._id];if(f)return f;f={v:I,p:I.p3(),d:[0,0,0],fix:!i.isLayoutable(I),s:i.getNodeSize3d(I)};var T=f.s,A=z.Default.getDistance(T)*i._nodeRepulsion;return f.r=1>A?100:A,i._nodeMap[I._id]=f,i._nodes.add(f),f},addEdge:function(E){if(E._40I&&E._41I){var D=this,b=D.addNode(E._40I),o=D.addNode(E._41I),u={s:b,t:o};o=o.s,b=b.s,u.length=_(v(o[0]+b[0])+v(o[1]+b[1])+v(o[2]+b[2]))*D._edgeRepulsion,u.length<=0&&(u.length=100),D._edges.add(u)}},relaxEdge:function(k){var A=k.t.p,r=k.s.p,B=k.t.d,W=k.s.d,g=A[0]-r[0],c=A[1]-r[1],z=A[2]-r[2],y=_(g*g+c*c+z*z),e=100*k.length,v=.25*g/e*y,S=.25*c/e*y,l=.25*z/e*y;B[0]-=v,B[1]-=S,B[2]-=l,W[0]+=v,W[1]+=S,W[2]+=l},relaxNode:function(n,N){if(n!==N){var z=n.p,e=N.p,l=0,k=0,s=0,g=z[0]-e[0],p=z[1]-e[1],t=z[2]-e[2],q=g*g+p*p+t*t;0===q?(l=x(),k=x(),s=x()):216e6>q&&(l=g/q,k=p/q,s=t/q);var A=n.r*N.r/400,V=n.d,K=N.d;l*=A,k*=A,s*=A,V[0]+=l,V[1]+=k,V[2]+=s,K[0]-=l,K[1]-=k,K[2]-=s}},moveNode:function(){var h=this,N=h._maxMotion,i=0,D=h._damper;h._nodes.each(function(p){if(!p.fix){var j=p.p,U=p.d,n=U[0]*D,g=U[1]*D,H=U[2]*D;U[0]=n/2,U[1]=g/2,U[2]=H/2,i=J(_(n*n+g*g+H*H),i),j[0]+=J(-40,e(40,n)),j[1]+=J(-40,e(40,g)),j[2]+=J(-40,e(40,H))}}),h._maxMotion=i,h._motionRatio=i>0?N/i-1:0,h.damp()}})}("undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:(0,eval)("this"),Object);