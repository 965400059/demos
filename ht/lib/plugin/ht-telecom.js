!function(R,H){"use strict";var K=ht.AlarmSeverity=function(I,E,F,i,q){this.value=I,this.name=E,this.nickName=F,this.color=i,this.displayName=q};ht.Default.def("ht.AlarmSeverity",H,{toString:function(){return this.displayName||this.name}}),function(){K.severities=new ht.List,K._vm={},K._nm={},K._cp=function(O,A){if(O&&A){var c=O.value-A.value;return c>0?1:0>c?-1:0}return O&&!A?1:!O&&A?-1:0},K.each=function(T,g){K.severities.each(T,g)},K.getSortFunction=function(){return K._cp},K.setSortFunction=function(g){K._cp=g,K.severities.sort(g)},K.add=function(B,d,P,D,$){var V=new K(B,d,P,D,$);return K._vm[B]=V,K._nm[d]=V,K.severities.add(V),K.severities.sort(K._cp),V},K.remove=function(n){var w=K._nm[n];return w&&(delete K._nm[n],delete K._vm[w.value],K.severities.remove(w)),w},K.CRITICAL=K.add(500,"Critical","C","#FF0000"),K.MAJOR=K.add(400,"Major","M","#FFA000"),K.MINOR=K.add(300,"Minor","m","#FFFF00"),K.WARNING=K.add(200,"Warning","W","#00FFFF"),K.INDETERMINATE=K.add(100,"Indeterminate","N","#C800FF"),K.CLEARED=K.add(0,"Cleared","R","#00FF00"),K.isClearedAlarmSeverity=function(D){return D?0===D.value:!1},K.getByName=function(u){return K._nm[u]},K.getByValue=function(A){return K._vm[A]},K.clear=function(){K.severities.clear(),K._vm={},K._nm={}},K.compare=function(B,l){return K._cp(B,l)}}();var j=ht.AlarmState=function(u){this._d=u,this._nm={},this._am={},this._ps=null,this._haa=null,this._hna=null,this._hoa=null,this._hta=null,this._hls=!1,this._aac=0,this._nac=0};ht.Default.def("ht.AlarmState",H,{_ep:!0,_f:function(){this._c1(),this._c2(),this._c3(),this._c4(),this._c5(),this._c6(),this._c7(),this._d.fp("alarmState",null,this)},getHighestAcknowledgedAlarmSeverity:function(){return this._haa},getHighestNewAlarmSeverity:function(){return this._hna},getHighestOverallAlarmSeverity:function(){return this._hoa},getHighestNativeAlarmSeverity:function(){return this._hta},hasLessSevereNewAlarms:function(){return this._hls},_c1:function(){var o=null;for(var V in this._am)V=K.getByName(V),K.isClearedAlarmSeverity(V)||0!==this.getAcknowledgedAlarmCount(V)&&(o=o?K.compare(o,V)>0?o:V:V);this._haa=o},_c2:function(){var F=null;for(var L in this._nm)L=K.getByName(L),K.isClearedAlarmSeverity(L)||0!==this.getNewAlarmCount(L)&&(F=F?K.compare(F,L)>0?F:L:L);this._hna=F},_c3:function(){if(!this._hna)return this._hls=!1,void 0;for(var F in this._nm)if(F=K.getByName(F),!K.isClearedAlarmSeverity(F)&&0!==this.getNewAlarmCount(F)&&K.compare(this._hna,F)>0)return this._hls=!0,void 0;this._hls=!1},_c4:function(){var I=this._haa,H=this._hna,p=this._ps;this._hoa=I,K.compare(H,this._hoa)>0&&(this._hoa=H),K.compare(p,this._hoa)>0&&(this._hoa=p)},_c5:function(){var $=this._haa,r=this._hna;this._hta=$,K.compare(r,this._hta)>0&&(this._hta=r)},increaseAcknowledgedAlarm:function(U,_){if(0!==_){_=_||1;var G=this._am[U.name]||0;G+=_,this._am[U.name]=G,this._f()}},increaseNewAlarm:function(l,C){if(0!==C){C=C||1;var i=this._nm[l.name]||0;i+=C,this._nm[l.name]=i,this._f()}},decreaseAcknowledgedAlarm:function(z,T){if(0!==T){T||(T=1);var m=this._am[z.name]||0;if(m-=T,0>m)throw"Alarm count can not be negative";this._am[z.name]=m,this._f()}},decreaseNewAlarm:function(F,n){if(0!==n){n||(n=1);var B=this._nm[F.name]||0;if(B-=n,0>B)throw"Alarm count can not be negative";this._nm[F.name]=B,this._f()}},acknowledgeAlarm:function(u){this.decreaseNewAlarm(u,1),this.increaseAcknowledgedAlarm(u,1)},acknowledgeAllAlarms:function(P){if(P){var W=this.getNewAlarmCount(P);this.decreaseNewAlarm(P,W),this.increaseAcknowledgedAlarm(P,W)}else for(var D in this._nm)this.acknowledgeAllAlarms(K.getByName(D))},_c6:function(){this._aac=0;for(var i in this._am)i=K.getByName(i),this._aac+=this.getAcknowledgedAlarmCount(i)},getAcknowledgedAlarmCount:function(R){return R?this._am[R.name]||0:this._aac},getAlarmCount:function(T){return this.getAcknowledgedAlarmCount(T)+this.getNewAlarmCount(T)},_c7:function(){this._nac=0;for(var E in this._nm)this._nac+=this.getNewAlarmCount(K.getByName(E))},getNewAlarmCount:function(Q){return Q?this._nm[Q.name]||0:this._nac},setNewAlarmCount:function(Y,R){this._nm[Y.name]=R,this._f()},removeAllNewAlarms:function(w){w?delete this._nm[w]:this._nm={},this._f()},setAcknowledgedAlarmCount:function(D,$){this._am[D.name]=$,this._f()},removeAllAcknowledgedAlarms:function(F){F?delete this._am[F.name]:this._am={},this._f()},isEmpty:function(){return!this._hoa},clear:function(){this._am={},this._nm={},this._f()},getPropagateSeverity:function(){return this._ps},setPropagateSeverity:function(I){if(this._ep||(I=null),this._ps!==I){var j=this._ps;this._ps=I,this._f(),this._d.fp("propagateSeverity",j,I)}},isEnablePropagation:function(){return this._ep},setEnablePropagation:function(p){var H=this._ep;this._ep=p,this._d.fp("enablePropagation",H,p)&&(p||this.setPropagateSeverity(null))}});var D=ht.AlarmStatePropagator=function(e){this._dataModel=e,this._enable=!1,this._isPropagating=!1};ht.Default.def("ht.AlarmStatePropagator",H,{getDataModel:function(){return this._dataModel},isEnable:function(){return this._enable},setEnable:function(j){this._enable!==j&&(this._enable=j,this._enable?(this._dataModel.mm(this.handleDataModelChange,this),this._dataModel.md(this.handleDataPropertyChange,this),this._dataModel.each(function(k){this.propagate(k)},this)):(this._dataModel.umm(this.handleDataModelChange,this),this._dataModel.umd(this.handleDataPropertyChange,this)))},handleDataModelChange:function($){$.data&&this.propagate($.data)},handleDataPropertyChange:function(r){if("alarmState"===r.property||"enablePropagation"===r.property)this.propagate(r.data);else if("parent"===r.property){var w=r.oldValue;w&&this.propagate(w),this.propagate(r.data)}},propagate:function(r){r&&!this._isPropagating&&(this._isPropagating=!0,this.propagateToTop(r),this._isPropagating=!1)},propagateToTop:function(f){for(this.propagateToParent(null,f);f&&f.getParent();)this.propagateToParent(f,f.getParent()),f=f.getParent()},propagateToParent:function(h,Z){var x=null;Z.getChildren().each(function(V){var P=V.getAlarmState().getHighestOverallAlarmSeverity();K.compare(P,x)>0&&(x=P)}),Z.getAlarmState().setPropagateSeverity(x)}}),ht.AlarmStateStatistics=function(D){this.sumNew=0,this.sumAcked=0,this.sumTotal=0,this.severtiyMap={},this.dataMap={},this.setDataModel(D)},ht.Default.def("ht.AlarmStateStatistics",H,{ms_fire:1,getDataModel:function(){return this._dataModel},setDataModel:function(T){var p=this._dataModel;p!==T&&(p&&(p.umd(this.handleDataPropertyChange,this),p.umm(this.handleDataModelChange,this),this.severtiyMap={},this.dataMap={}),this._dataModel=T,this.reset(),T.md(this.handleDataPropertyChange,this),T.mm(this.handleDataModelChange,this),this.fp("dataModel",p,T))},dispose:function(){this._dataModel.umd(this.handleDataPropertyChange,this),this._dataModel.umm(this.handleDataModelChange,this),delete this._dataModel},handleDataPropertyChange:function(h){"alarmState"===h.property&&(this.increase(h.data),this.fireAlarmStateChange())},handleDataModelChange:function(t){"add"===t.kind?(this.increase(t.data),this.fireAlarmStateChange()):"remove"===t.kind?(this.decrease(t.data),this.fireAlarmStateChange()):"clear"===t.kind&&(this.severtiyMap={},this.dataMap={},this.fireAlarmStateChange())},fireAlarmStateChange:function(){this.sumAcked=0,this.sumNew=0,this.sumTotal=0,K.each(function(b){var U=this.getSumInfo(b);this.sumAcked+=U.ackedCount,this.sumNew+=U.newCount,this.sumTotal+=U.totalCount},this),this.fp("alarmState",!1,!0)},getNewAlarmCount:function(W){if(!W)return this.sumNew;var A=this.getSumInfo(W);return A.newCount},getAcknowledgedAlarmCount:function(Q){if(!Q)return this.sumAcked;var e=this.getSumInfo(Q);return e.ackedCount},getTotalAlarmCount:function(U){if(!U)return this.sumTotal;var m=this.getSumInfo(U);return m.totalCount},getSumInfo:function(I){var u=this.severtiyMap[I.name];return u||(u={},u.newCount=0,u.ackedCount=0,u.totalCount=0,this.severtiyMap[I.name]=u),u},decrease:function(b){var l=this.dataMap[b.getId()];l&&(delete this.dataMap[b.getId()],K.each(function(S){var v=l[S.name],Q=this.getSumInfo(S);Q.newCount=Q.newCount-v.newCount,Q.ackedCount=Q.ackedCount-v.ackedCount,Q.totalCount=Q.totalCount-v.totalCount},this))},increase:function(t){if(this.decrease(t),!this._filterFunc||this._filterFunc(t)){var f={},F=t.getAlarmState();this.dataMap[t.getId()]=f,K.each(function(X){var M={};M.newCount=F.getNewAlarmCount(X),M.ackedCount=F.getAcknowledgedAlarmCount(X),M.totalCount=F.getAlarmCount(X),f[X.name]=M;var B=this.getSumInfo(X);B.newCount=B.newCount+M.newCount,B.ackedCount=B.ackedCount+M.ackedCount,B.totalCount=B.totalCount+M.totalCount},this)}},reset:function(){this.severtiyMap={},this.dataMap={},this._dataModel.each(this.increase,this),this.fireAlarmStateChange()},setFilterFunc:function(Z){var o=this._filterFunc;this._filterFunc=Z,this.reset(),this.fp("filterFunc",o,Z)},getFilterFunc:function(){return this._filterFunc}});var x=ht.Data.prototype;x.getAlarmState=function(){return this._alarmState||(this._alarmState=new j(this))},x=ht.DataModel.prototype,x.isEnableAlarmStatePropagator=function(){return!!this._alarmStatePropagator&&this._alarmStatePropagator.isEnable()},x.setEnableAlarmStatePropagator=function(S){S!=this.isEnableAlarmStatePropagator()&&(S?(this._alarmStatePropagator=new D(this)).setEnable(!0):this._alarmStatePropagator.setEnable(!1))},x=ht.graph.GraphView.prototype,x.getNote2=function(j){var y=j.getAlarmState().getHighestNewAlarmSeverity();if(y){var J=j.getAlarmState().getNewAlarmCount(y)+y.nickName;return j.getAlarmState().hasLessSevereNewAlarms()&&(J+="+"),J}return j.s("note2")},x.getNote2Background=function(h){var o=h.getAlarmState().getHighestNewAlarmSeverity();return o?o.color:h.s("note2.background")},x.getBodyColor=function(X){var $=X.getAlarmState().getHighestNativeAlarmSeverity();return $?$.color:X.s("body.color")},x.getBorderColor=function(I){var v=I.getAlarmState().getPropagateSeverity();return v?v.color:I.s("border.color")},x=ht.widget.TreeView.prototype,x.getBorderColor=function(z){var X=z.getAlarmState().getPropagateSeverity();return X?X.color:z.s("border.color")},x.getIcon=function(g){return g.getIcon()?"__alarmIcon__":null},x=ht.widget.TreeTableView.prototype,x.getBorderColor=function(q){var W=q.getAlarmState().getPropagateSeverity();return W?W.color:q.s("border.color")},x.getIcon=function(r){return r.getIcon()?"__alarmIcon__":null},ht.Default.setImage("__alarmIcon__",{width:16,height:16,comps:[{type:"image",name:{func:function(S){return S.getIcon()}},color:{func:function(P){var _=P.getAlarmState().getHighestNativeAlarmSeverity();return _?_.color:P.s("body.color")}},rect:[0,0,16,16]}]});var b=ht.Style;b["note2.expanded"]=!0,b["note2.color"]="#000"}("undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:(0,eval)("this"),Object);